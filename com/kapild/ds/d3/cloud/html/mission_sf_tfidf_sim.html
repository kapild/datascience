<!DOCTYPE html>
<meta charset="utf-8">
<body>
<style type="text/css">
.x-axis path {
    stroke:white;
    fill:none;
}
.x-axis line {
    fill: none;
    stroke: none;
    stroke-opacity:.8;
    shape-rendering: crispEdges;
}
.bars rect {
    fill:steelblue;
    fill-opacity:.9;
}
.title {
    font-weight: bold;
}
#precise-value {
    fill:white;
    font-size: 12px;
}
</style>
<script src="../js/d3/d3.js"></script>
<script src="../js/d3/d3.layout.cloud.js"></script>
<script>
  var fill = d3.scale.category20();

  d3.layout.cloud().size([900, 800])
      .words(
[["chicken", 0.49067714970159049], ["salad", 0.23598711571702269], ["beef", 0.18716219522384558], ["grilled", 0.16337569549640032], ["pork", 0.14459687992210143], ["rice", 0.13303061313503037], ["cheese", 0.13177839292728358], ["fried", 0.12438362328125341], ["shrimp", 0.11356235768116218], ["soup", 0.11016905136922014], ["tofu", 0.099891595813619408], ["meatless", 0.093940520018176543], ["95", 0.092855359572839802], ["roll", 0.092600238454961056], ["meatless chicken", 0.088771281882655109], ["crispy", 0.08710749026680055], ["sandwich", 0.085171768260871639], ["sauce", 0.083236046254942742], ["vegetable", 0.080483520946693379], ["premium", 0.079284067668422067], ["snack wrap", 0.078181909043922165], ["snack", 0.075071007843474757], ["spicy", 0.070107578144049179], ["wrap", 0.068856955713719789], ["steak", 0.067105029538868571], ["prawns", 0.066515306567515184], ["garlic", 0.066351815029189409], ["pollo", 0.066180791114586468], ["lunch special", 0.066030477918463865], ["chocolate", 0.063222012433472932]]
.map(function(d) {
        return {text: d[0], size: 30  + d[1] * 100};
      }))
      .padding(5)
      .rotate(function() { return ~~(Math.random() * 0) * 90; })
      .font("Impact")
      .fontSize(function(d) { return d.size; })
      .on("end", draw)
      .start();

  function draw(words) {
    d3.select("body").append("svg")
        .attr("width", 900)
        .attr("height", 800)
      .append("g")
        .attr("transform", "translate(450,400)")
      .selectAll("text")
        .data(words)
      .enter().append("text")
        .style("font-size", function(d) { return d.size + "px"; })
        .style("font-family", "Impact")
        .style("fill", function(d, i) { return fill(i); })
        .attr("text-anchor", "middle")
        .attr("transform", function(d) {
          return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
        })
        .text(function(d) { return d.text; });
  }

    var margin = {top: 50, bottom: 50, left:250, right: 40};
    var width = 900 - margin.left - margin.right;
    var height = 450 - margin.top - margin.bottom;

    var xScale = d3.scale.linear().range([0, width]);
    var yScale = d3.scale.ordinal().rangeRoundBands([0, height], 1.8,0);

    var numTicks = 5;
   var xAxis = d3.svg.axis().scale(xScale)
                    .orient("top")
                    .tickSize((-height))
                    .ticks(numTicks);
    var svg = d3.select("body").append("svg1")
                .attr("width", width+margin.left+margin.right)
                .attr("height", height+margin.top+margin.bottom)
                .attr("class", "base-svg");
  var barSvg = svg.append("g")
                .attr("transform", "translate("+margin.left+","+margin.top+")")
                .attr("class", "bar-svg");

    var x = barSvg.append("g")
            .attr("class", "x-axis");

    var url = "data.json";

   d3.json(url, function(data) {

        var xMax = d3.max(data, function(d) { return d.rate; } );
        var xMin = 0;
        xScale.domain([xMin, xMax]);
        yScale.domain(data.map(function(d) { return d.country; }));

        d3.select(".base-svg").append("text")
            .attr("x", margin.left)
            .attr("y", (margin.top)/2)
            .attr("text-anchor", "start")
            .text("Narrowly defined unemployment rates: top 20 countries (2010)")
            .attr("class", "title");

        var groups = barSvg.append("g").attr("class", "labels")
                    .selectAll("text")
                    .data(data)
                    .enter()
                    .append("g");

        groups.append("text")
                .attr("x", "0")
                .attr("y", function(d) { return yScale(d.country); })
                .text(function(d) { return d.country; })
                .attr("text-anchor", "end")
                .attr("dy", ".9em")
                .attr("dx", "-.32em")
                .attr("id", function(d,i) { return "label"+i; });

        var bars = groups
                    .attr("class", "bars")
                    .append("rect")
                    .attr("width", function(d) { return xScale(d.rate); })
                    .attr("height", height/20)
                    .attr("x", xScale(xMin))
                    .attr("y", function(d) { return yScale(d.country); })
                    .attr("id", function(d,i) { return "bar"+i; });

        groups.append("text")
                .attr("x", function(d) { return xScale(d.rate); })
                .attr("y", function(d) { return yScale(d.country); })
                .text(function(d) { return d.rate; })
                .attr("text-anchor", "end")
                .attr("dy", "1.2em")
                .attr("dx", "-.32em")
                .attr("id", "precise-value");

        bars
            .on("mouseover", function() {
                var currentGroup = d3.select(this.parentNode);
                currentGroup.select("rect").style("fill", "brown");
                currentGroup.select("text").style("font-weight", "bold");
            })
            .on("mouseout", function() {
                var currentGroup = d3.select(this.parentNode);
                currentGroup.select("rect").style("fill", "steelblue");
                currentGroup.select("text").style("font-weight", "normal");
            });

        x.call(xAxis);
        var grid = xScale.ticks(numTicks);
        barSvg.append("g").attr("class", "grid")
            .selectAll("line")
            .data(grid, function(d) { return d; })
            .enter().append("line")
                .attr("y1", 0)
                .attr("y2", height+margin.bottom)
                .attr("x1", function(d) { return xScale(d); })
                .attr("x2", function(d) { return xScale(d); })
                .attr("stroke", "white");
 });
</script>
